#!/usr/bin/env ruby

require File.expand_path(File.dirname(__FILE__) + "/../lib/stasis")

Stasis::Gems.activate %w(slop)
require 'slop'

opts = Slop.parse :help => true do
  on :d, :development, "Development mode\t\t(auto-regenerate)"
  on :o, :only, "Only generate specific files\t(comma-separated)", :as => Array
  on :r, :redis, "Redis address\t\t(default: localhost:6379)", :optional => true, :default => "localhost:6379"
end

args = []
opts.parse { |arg| args << arg }

dir = args.first || Dir.pwd

if opts.development?
  Stasis::Auto.new(dir)
elsif opts.only?
  Stasis.new(dir).generate(:only => opts[:only])
elsif opts.redis?
  Stasis::Daemon.new(opts)
else
  Stasis.new(dir).generate
end