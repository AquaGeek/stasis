#!/usr/bin/env ruby

require File.expand_path(File.dirname(__FILE__) + "/../lib/stasis")

Stasis::Gems.activate %w(slop)
require 'slop'

opts = Slop.parse :help => true do
  on :a, :auto, 'Auto-regenerate'
  on :b, :beanstalk, 'Beanstalk addresses (comma-separated, default: localhost:11300)', :optional => true, :as => Array, :default => "localhost:11300"
  on :o, :only, 'Only generate specific files (comma-separated)', :as => Array
end

args = []
opts.parse { |arg| args << arg }

dir = args.first || Dir.pwd

if opts.auto?
  Stasis::Auto.new(dir)
elsif opts.only?
  Stasis.new(dir).generate(:only => opts[:only])
elsif opts.beanstalk?
  Stasis::Daemon.new(opts)
else
  Stasis.new(dir).generate
end