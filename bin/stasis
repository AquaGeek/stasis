#!/usr/bin/env ruby

require File.expand_path(File.dirname(__FILE__) + "/../lib/stasis")

Stasis::Gems.activate %w(slop)
require 'slop'

opts = Slop.parse :help => true do
  on :a, :auto, 'Auto-regenerate'
  on :o, :only, 'Only generate specific files (comma-separated)', :as => Array
  on :p, :port, 'Port (daemon mode)', :optional => true, :as => Integer, :default => 7000
end

args = []
opts.parse { |arg| args << arg }

dir = args.first || Dir.pwd

if opts.auto?
  Stasis::Auto.new(dir)
elsif opts.only?
  Stasis.new(dir).generate(:only => opts[:only])
elsif opts.port?
  Stasis::Daemon.new(dir, opts[:port])
else
  Stasis.new(dir).generate
end